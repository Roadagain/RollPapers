<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8"/>
  <title>巻きすぎ注意</title>
  <link rel="stylesheet" href="main.css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script type="text/javascript" src="https://rawgit.com/padolsey-archive/jquery.fn/master/cross-domain-ajax/jquery.xdomainajax.js"></script>
  <script type='text/javascript'>
    var show = function() {
      $.get("http://sabae.club/siot/", function(r){
        src = eval(r.responseText.replace(/<.*>/g, '')).filter(function (x){
          return x.channel === 5;
        }).pop();
        console.log(src);
        var el = document.getElementById("result");
        el.innerHTML = myRound(100 - src.value/8.0, 1) + "巻き";
      });
    };
    
   function myRound(val, precision){
     digit = Math.pow(10, precision);
     val = val * digit;
     val = Math.round(val);
     val = val / digit;
     return val;
   }
    
    window.onload = function() {
      $.ajaxSetup({cache: false});
      window.setInterval(show, 5000);
    }
  </script>
</head>
<body>
  <div id="title">
    巻きすぎ注意
    <img src="toilet_paper.png"/>
  </div>

  <div id="contents">
    <p>あと</p>
    <div id="result"></div>
  </div>
</body>
</html>
